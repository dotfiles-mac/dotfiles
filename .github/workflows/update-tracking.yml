---
name: Update Tracking Issue

on:
  issues:
    types: [opened, closed, reopened]
  pull_request:
    types: [opened, closed, reopened, synchronize]

jobs:
  update-tracking:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: read
    steps:
    - name: Update tracking issue
      uses: actions/github-script@v8
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const trackingIssueNumber = 5;

          const { action, number } = context.payload;
          const isIssue = context.eventName === 'issues';
          const item = context.payload[isIssue ? 'issue' : 'pull_request'];
          const type = isIssue ? 'Issue' : 'PR';
          const state = item.state;
          const title = item.title;

          const status = state === 'open' ? 'OPEN' :
                        state === 'closed' && !isIssue ? 'CLOSED' :
                        state === 'merged' ? 'MERGED' : state.toUpperCase();

          const updateMsg = `[${type} #${number}] ${action} - ${status}: ${title}`;

          await github.rest.issues.createComment({
            owner: context.repo.owner,
            repo: context.repo.repo,
            issue_number: trackingIssueNumber,
            body: updateMsg
          });
